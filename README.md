# Тест задержки нажатия для Android

Приложение для точного измерения времени задержки между нажатием на экран и фактическим отображением результата на Android-устройствах с учетом всех характеристик конкретного устройства.

## Описание

Это приложение позволяет измерить фактическое время отклика системы Android на нажатия пользователя. Приложение использует высокоточные таймеры, учитывает частоту обновления экрана, частоту опроса сенсорного экрана, режим энергосбережения и множество других параметров системы для максимально точного измерения полной задержки между физическим нажатием и отрисовкой интерфейса.

## Функциональность

- Измерение полной задержки между нажатием и отображением результата на экране в миллисекундах
- Учет всех компонентов задержки:
  - Сенсорный отклик (время регистрации касания сенсором)
  - Ожидание vsync (время до начала нового кадра)
  - Обработка системой (Android OS и драйверы)
  - Рендеринг (формирование нового кадра)
  - Физическое обновление экрана (время обновления пикселей)
- Учет характеристик устройства:
  - Текущая и максимальная частота обновления экрана
  - Приблизительная частота опроса сенсора (определяется на основе модели устройства)
  - Режим энергосбережения и влияние на производительность
  - Игровой режим (на поддерживаемых устройствах)
  - Уровень заряда батареи и состояние зарядки
  - Уровень общей производительности системы
- Адаптация расчетов под характеристики экрана (60/90/120/144+ Гц)
- Оценка производительности устройства на основе полученных результатов
- Ведение статистики по всем тестам
- Возможность сброса результатов

## Технические детали

Приложение использует:
- `SystemClock.elapsedRealtimeNanos()` для максимальной точности измерения времени
- Android Choreographer для синхронизации с циклом отрисовки кадров
- Последовательность нескольких фреймов для отслеживания всего пути события касания
- Оценку времени отклика сенсорного экрана на основе характеристик устройства
- Коррекцию результатов с учетом конкретной частоты обновления дисплея 
- Определение характеристик дисплея через WindowManager и Display API
- Определение режима энергосбережения через PowerManager
- Определение уровня заряда и статуса через BatteryManager
- Обнаружение игрового режима для Samsung, Xiaomi и OnePlus устройств
- Jetpack Compose для создания современного пользовательского интерфейса
- Поддержка новейших версий Android (минимальная версия SDK 24, целевая версия SDK 35)

## Компоненты задержки

Приложение измеряет и отображает следующие компоненты общей задержки:

1. **Сенсорный отклик (Touch Detection)** - время между физическим нажатием на экран и регистрацией этого нажатия операционной системой. Зависит от частоты опроса сенсорного экрана (обычно 60-360 Гц).

2. **Ожидание vsync (Vsync Wait)** - время ожидания до следующего сигнала вертикальной синхронизации (vsync). Это системный механизм, который определяет момент начала отрисовки нового кадра.

3. **Обработка системой (OS Processing)** - время, затрачиваемое операционной системой Android и драйверами на обработку события касания и подготовку к отрисовке интерфейса. Корректируется с учетом режима энергосбережения.

4. **Рендеринг (Rendering)** - время, затрачиваемое на фактическое формирование нового кадра. Также учитывает текущую производительность системы.

5. **Обновление экрана (Display Refresh)** - время, необходимое для физического обновления пикселей на экране устройства. Зависит от технологии дисплея.

Общая задержка представляет собой сумму всех этих компонентов с коррекцией для конкретной частоты обновления дисплея.

## Учет характеристик системы

Приложение учитывает следующие характеристики конкретного устройства:

1. **Текущая частота обновления экрана** - полученная через API устройства, а не константное значение. Для устройств с переменной частотой обновления измеряется фактическая частота.

2. **Максимальная и минимальная частота обновления** - определяется через Display API на Android 11+.

3. **Частота опроса сенсорного экрана** - оценивается на основе:
   - Модели устройства (игровые, флагманские, среднего класса)
   - Версии Android
   - Максимальной частоты обновления экрана
   - Наличия игрового режима

4. **Режим энергосбережения** - определяется через PowerManager и влияет на:
   - Сенсорный отклик (увеличивается задержка)
   - Время обработки системой (увеличивается)
   - Текущую частоту обновления экрана (часто снижается до 60 Гц)

5. **Игровой режим** - на поддерживаемых устройствах (Samsung, Xiaomi, OnePlus):
   - Улучшает время сенсорного отклика
   - Улучшает время обработки системой

6. **Уровень заряда и режим зарядки**:
   - Низкий заряд (<15%) может снижать производительность
   - Средний заряд (15-50%) может умеренно снижать производительность

## Как работает измерение

1. При нажатии на экран записывается начальное время с точностью до наносекунд
2. Добавляется приблизительная оценка времени сенсорного отклика с учетом типа устройства
3. Применяется коррекция на основе режима производительности (энергосбережение/игровой)
4. Измеряется время ожидания до следующего vsync события
5. Для трех последовательных кадров измеряются:
   - время обработки системой (с коррекцией производительности)
   - время рендеринга (с коррекцией производительности)
   - время обновления экрана
6. Все компоненты суммируются и применяется коррекция с учетом фактической частоты обновления дисплея

## Интерпретация результатов

Результат измерения задержки можно интерпретировать следующим образом:

- **< 20 мс**: Отличная задержка (уровень игровых устройств)
- **20-33 мс**: Очень хорошая задержка (ниже времени кадра на 60 Гц дисплее)
- **33-50 мс**: Хорошая задержка (типично для устройств среднего класса)
- **50-70 мс**: Средняя задержка (заметная, но не критичная)
- **70-100 мс**: Ниже среднего (значительная задержка)
- **> 100 мс**: Высокая задержка (может мешать нормальному взаимодействию)

### Важные замечания:

1. **Минимальная теоретическая задержка** на устройстве с дисплеем 60 Гц составляет около 16.7 мс (время одного кадра) плюс время сенсорного отклика. Таким образом, значения от 20 до 30 мс являются очень хорошими для мобильных устройств.

2. **Частота обновления дисплея** значительно влияет на минимально возможную задержку:
   - 60 Гц: минимум ~16.7 мс
   - 90 Гц: минимум ~11.1 мс
   - 120 Гц: минимум ~8.3 мс
   - 144 Гц: минимум ~6.9 мс

3. **Частота опроса сенсора** также важна для общей задержки:
   - 60 Гц сенсор: ~8-16 мс задержки
   - 120 Гц сенсор: ~4-8 мс задержки
   - 240 Гц сенсор: ~2-4 мс задержки
   - 360 Гц сенсор: ~1.4-2.8 мс задержки

4. **Режим энергосбережения** может увеличить задержку на 15-20%

5. **Игровой режим** может снизить задержку на 5-10%

6. **Сравнительные показатели по устройствам**:
   - Высокопроизводительные игровые устройства: 15-30 мс
   - Флагманские телефоны: 20-40 мс
   - Устройства среднего класса: 30-60 мс
   - Бюджетные устройства: 50-100 мс и выше

## Как использовать

1. Запустите приложение на устройстве
2. Обратите внимание на определенные параметры системы (частота обновления, режим и т.д.)
3. Нажмите на большую кнопку в центре экрана
4. После нажатия система измерит все компоненты задержки
5. Просмотрите детализированный результат в разделе "Детализация задержки"
6. Ознакомьтесь с общей оценкой производительности 
7. Повторите несколько раз для получения более точных средних значений
8. При необходимости нажмите "Сбросить статистику" для новой серии тестов

## Совместимость

Приложение совместимо с Android 7.0 (API уровень 24) и выше.

- На Android 11+ (API 30+) доступно определение максимальной/минимальной частоты обновления
- На Android 9+ (API 28+) доступны расширенные методы определения производительности
- На Android 5.0+ (API 21+) доступно определение режима энергосбережения 